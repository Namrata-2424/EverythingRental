<div class="container py-4">
  <!-- LIST VIEW -->
  <ng-container *ngIf="!borrow">
    <h3 class="mb-4 fw-semibold">My Borrowed Tools</h3>

    <div *ngIf="borrows.length === 0" class="alert alert-light text-center">
      You haven’t borrowed any tools yet.
    </div>

    <div *ngFor="let b of borrows" class="card mb-3 shadow-sm">
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <h5 class="card-title mb-1">
            {{ b.title }}
            <span
              *ngIf="b.return_status === 'Initiated'"
              class="badge bg-warning text-dark ms-2"
            >
              Return Initiated
            </span>
          </h5>
          <p class="card-text text-muted mb-0">
            Qty: {{ b.quantity }} • Due: {{ b.due_date | date }}
          </p>
        </div>

        <div class="d-flex gap-2">
          <!-- VIEW -->
          <button
            class="btn btn-outline-primary btn-sm"
            (click)="view(b.borrow_uuid)"
          >
            View
          </button>

          <!-- RETURN (only if still borrowed) -->
          <button
            *ngIf="b.return_status === 'Borrowed'"
            class="btn btn-outline-danger btn-sm"
            (click)="returnTool(b.borrow_uuid)"
            [disabled]="loading"
          >
            Return
          </button>

          <!-- RETURN INITIATED -->
          <span
            *ngIf="b.return_status === 'Initiated'"
            class="badge bg-warning text-dark align-self-center"
          >
            Return Initiated
          </span>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- DETAIL VIEW -->
  <ng-container *ngIf="borrow">
    <button class="btn btn-link px-0 mb-3" (click)="back()">← Back</button>

    <!-- Tool Info -->
    <div class="card mb-3 shadow-sm">
      <div class="card-body">
        <h4 class="card-title">{{ borrow.title }}</h4>
        <p class="card-text">{{ borrow.description }}</p>

        <div class="row mt-3">
          <div class="col-md-6">
            <strong>Borrowed Quantity:</strong> {{ borrow.borrowed_quantity }}
          </div>
          <div class="col-md-6">
            <strong>Due Date:</strong> {{ borrow.due_date | date }}
          </div>
        </div>
      </div>
    </div>

    <!-- Lender Info -->
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title mb-3">Lender Details</h5>

        <p class="mb-1">
          <strong>Name:</strong>
          {{ borrow.lender_first_name }} {{ borrow.lender_last_name }}
        </p>

        <p class="mb-1">
          <strong>Username:</strong> {{ borrow.lender_username }}
        </p>

        <p class="mb-1"><strong>Phone:</strong> {{ borrow.lender_phone }}</p>

        <p class="mb-0">
          <strong>Notes:</strong>
          {{ borrow.tool_description || "—" }}
        </p>
      </div>
    </div>
  </ng-container>
</div>
